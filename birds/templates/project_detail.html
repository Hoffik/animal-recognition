{% extends 'base.html' %}

{% block content %}

<div ng-controller="ProjectDetailCtrl" ng-init="getProject('{{ project_dir }}')" ng-cloak class="form-container">

<div ng-show="error_message">[[ error_message ]]</div>
<div ng-hide="error_message">

<h1>[[ project.name ]]</h1>

<form>
{% csrf_token %}

{% comment %} <div class="container"> {% endcomment %}
<div class="container-part-1-2">
            
    <div class="form-group">
        <div class="form-label">
            <label>ID:</label>
        </div>
        <div class="form-value">
            <div class="value">[[ project.id ]]</div>
        </div>
    </div>
    <div class="form-group">
        <div class="form-label">
            <label>Name:</label>
        </div>
        <div class="form-value">
            <input type="text" name="name" ng-model="project.name">
        </div>
        <div class="form-value">
            <button ng-click="updateProject(project)">Update</button>
        </div>
    </div>
    <div class="form-group">
        <div class="form-label">
            <label>Directory:</label>
        </div>
        <div class="form-value"> 
            <div class="value">[[ project.directory ]]</div>
        </div>
    </div>
    <div class="form-group">
        <div class="form-label">
            <label>File type:</label>
        </div>
        <div class="form-value"> 
            <div class="value">[[ project.file_type ]]</div>
        </div>
    </div>

</div>

<div class="container-part-1-2">

    <div class="form-group">
        <div class="form-label">
            <label># Tags:</label>
        </div>
        <div class="form-value">
            <div class="value">[[ project.tag_count ]]</div>
        </div>
    </div>
    <div class="form-group">
        <div class="form-label">
            <label># Records:</label>
        </div>
        <div class="form-value">
            <div class="value">[[ project.record_count ]] ([[ project.record_with_file_count ]] with file)</div>
        </div>
    </div>
    <div class="form-group">
        <div class="form-label">
            <label># Users:</label>
        </div>
        <div class="form-value">
            <div class="value">[[ project.right_count ]] ([[ project.owner_count ]], [[ project.expert_count ]], [[ project.layman_count ]])</div>
        </div>
    </div>
    <div class="form-group">
        <div class="form-label">
            <label># Entries:</label>
        </div>
        <div class="form-value">
            <div class="value">[[ project.identification_count ]]</div>
        </div>
    </div>

</div>

{% comment %} <div class="form-group">
    <div class="form-label">
            <label></label>
        </div>
        <div class="form-value">
            <button ng-click="updateProject(project)">Update</button>
        </div>
</div> {% endcomment %}

</form>
{% comment %} </div> {% endcomment %}


<h2>Project users:</h2>

<form>
{% csrf_token %}

    <div class="table-responsive">          
        <table class="table">
            <thead>
                <tr>
                    <th>Username:</th>
                    <th>Email:</th>
                    <th># Entries</th>
                    <th>Role</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <div class="dropdown">
                            <button class="select dropdown-toggle" data-toggle="dropdown" title="User name">
                                [[ new_user.username ]] <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu">
                                <li ng-repeat="user_wo_rights in project.users_wo_rights">
                                    <button class="dropdown-choice" ng-class="{active: new_user.username == user_wo_rights.username}" ng-click="updateNewUser(user_wo_rights.username, undefined, undefined)">[[ user_wo_rights.username ]]</button>
                                </li>
                            </ul>
                        </div>
                    </td>
                    <td>
                        <div class="dropdown">
                            <button class="select dropdown-toggle" data-toggle="dropdown" title="User email">
                                [[ new_user.email ]] <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu">
                                <li ng-repeat="user_wo_rights in project.users_wo_rights">
                                    <button class="dropdown-choice" ng-class="{active: new_user.email == user_wo_rights.email}" ng-click="updateNewUser(undefined, user_wo_rights.email, undefined)">[[ user_wo_rights.email ]]</button>
                                </li>
                            </ul>
                        </div>
                    </td>
                    <td></td>
                    <td>
                        <div class="dropdown">
                            <button class="select dropdown-toggle" data-toggle="dropdown" title="User role">
                                [[ new_user_role_name ]] <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu">
                                <li ng-repeat="role_name in project.role_names">
                                    <button class="dropdown-choice" ng-class="{active: new_user_role_name == role_name}" ng-click="updateNewUser(undefined, undefined, role_name)">[[ role_name ]]</button>
                                </li>
                            </ul>
                        </div>
                    </td>
                    <td><button class="send" ng-click="addRight()">Add</button></td>
                </tr>
                {% comment %} <tr>
                    <td><select ng-model="new_user" ng-options="user_wo_rights.username for user_wo_rights in project.users_wo_rights"></select></td>
                    <td><select ng-model="new_user" ng-options="user_wo_rights.email for user_wo_rights in project.users_wo_rights"></select></td>
                    <td></td>
                    <td><select ng-model="new_user_role" ng-options="role_name for role_name in project.role_names"></select></td>
                    <td></td>
                    <td><button ng-click="addRight()">Add</button></td>
                </tr>  {% endcomment %}
                <tr ng-repeat="right in project.rights | orderBy:['role','-name']">
                    <td>[[ right.username ]]</td>
                    <td>[[ right.email ]]</td>
                    <td>[[ right.identification_count ]]</td>

                    <td>
                        <div class="dropdown">
                            <button class="select dropdown-toggle" data-toggle="dropdown" title="User role">
                                [[ right.role_name ]] <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu">
                                <li ng-repeat="role_name in project.role_names">
                                    <button class="dropdown-choice" ng-class="{active: right.role_name == role_name}" ng-click="updateRight(right, role_name)">[[ role_name ]]</button>
                                </li>
                            </ul>
                        </div>
                        {% comment %} <select ng-model="right.role_name" ng-options="role_name for role_name in project.role_names"></select> {% endcomment %}
                    </td>
                    {% comment %} <td><input type="text" name="role" ng-model="right.role_name" ng-value="1"></td> {% endcomment %}
                    <td><button class="send" ng-click="deleteRight(right)">Remove</button></td>
                </tr>
            </tbody>
        </table>
    </div>
</form>

</div>

</div>

{% endblock content %}

